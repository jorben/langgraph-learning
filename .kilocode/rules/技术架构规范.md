# LangGraph 学习项目技术规范

## 1. 项目概述

**项目名称**：LangGraph 学习项目  
**项目类型**：教育性代码示例集合  
**目标**：通过一系列渐进式示例，系统性地学习和掌握 LangGraph 框架的核心概念和高级特性。

### 1.1 项目结构

```
langgraph-learning/
├── example_01/          # 简单顺序工作流
├── example_02/          # 条件分支
├── example_03/          # 简单循环
├── example_04/          # 多工具调用
├── example_05-10/       # 更多高级特性示例
├── pyproject.toml       # 统一依赖管理
├── uv.lock              # 依赖锁文件
└── .env.example         # 环境变量模板
```

### 1.2 设计原则

1. **渐进式学习**：从简单到复杂，逐步引入新概念
2. **一致性**：所有示例遵循相同的代码结构和规范
3. **可复现性**：每个示例都能独立运行
4. **文档完整性**：每个示例都有详细的 README 说明

## 2. 技术栈规范

### 2.1 核心依赖（强制）

所有示例必须使用以下核心依赖的指定版本范围：

| 组件             | 版本范围 | 用途           | 约束类型 |
| ---------------- | -------- | -------------- | -------- |
| Python           | ≥3.13    | 运行时环境     | 强制     |
| LangGraph        | ≥0.2.0   | 工作流编排框架 | 强制     |
| LangChain        | ≥0.3.0   | AI 应用框架    | 强制     |
| LangChain-OpenAI | ≥0.2.0   | OpenAI 集成    | 强制     |
| python-dotenv    | ≥1.0.0   | 环境变量管理   | 强制     |

### 2.2 可选依赖

根据示例需求选择性使用：

| 组件     | 用途        | 使用场景               |
| -------- | ----------- | ---------------------- |
| tiktoken | Token 计数  | 需要成本控制的示例     |
| tenacity | 重试机制    | 需要容错处理的示例     |
| orjson   | 高性能 JSON | 需要处理大量数据的示例 |

### 2.3 开发工具

| 工具  | 版本 | 用途             | 配置位置       |
| ----- | ---- | ---------------- | -------------- |
| uv    | 最新 | 包管理和项目构建 | 项目根目录     |
| black | 最新 | 代码格式化       | pyproject.toml |
| isort | 最新 | 导入排序         | pyproject.toml |
| mypy  | 最新 | 类型检查         | pyproject.toml |

## 3. 代码结构规范

### 3.1 目录结构

每个示例目录必须包含：

```
example_XX/
├── README.md           # 示例说明文档（必须）
├── main.py             # 主程序文件（必须）
├── requirements.txt    # 可选，如有特殊依赖
└── run.sh              # 可选，运行脚本
```

### 3.2 文件命名规范

- Python 文件：使用蛇形命名法（snake_case），如 `article_generator.py`
- 配置文件：使用点前缀，如 `.env.example`
- 脚本文件：使用有意义的名称，如 `run.sh`

### 3.3 状态定义规范

```python
# 必须使用 TypedDict 定义状态
from typing import TypedDict

class ExampleState(TypedDict):
    """状态定义必须有文档字符串"""
    # 字段名使用蛇形命名法
    input_data: str
    processed_result: str
    current_step: str
    # 可选：错误信息字段
    error_message: str | None
```

### 3.4 节点函数规范

```python
def node_function(state: ExampleState) -> ExampleState:
    """
    节点函数必须有完整的文档字符串

    Args:
        state: 当前状态

    Returns:
        更新后的状态

    Raises:
        ValueError: 当输入无效时
    """
    # 1. 从状态中读取数据
    data = state.get("input_data", "")

    # 2. 参数验证
    if not data:
        raise ValueError("输入数据不能为空")

    # 3. 核心逻辑
    result = process_data(data)

    # 4. 返回更新后的状态
    return {
        **state,  # 保留原有状态
        "processed_result": result,
        "current_step": "node_completed"
    }
```

### 3.5 工作流构建规范

```python
def create_workflow():
    """工作流构建函数"""
    # 1. 创建状态图
    workflow = StateGraph(ExampleState)

    # 2. 添加节点（按执行顺序）
    workflow.add_node("first_node", first_node_function)
    workflow.add_node("second_node", second_node_function)

    # 3. 设置入口点
    workflow.set_entry_point("first_node")

    # 4. 添加边
    workflow.add_edge("first_node", "second_node")
    workflow.add_edge("second_node", END)

    # 5. 编译并返回
    return workflow.compile()
```

## 4. 配置管理规范

### 4.1 环境变量

- 必须使用 `.env.example` 作为模板
- 敏感信息（API 密钥）必须通过环境变量配置
- 环境变量命名使用大写蛇形命名法，如 `OPENAI_API_KEY`

### 4.2 配置文件

- 统一使用 `pyproject.toml` 管理项目元数据和依赖
- 开发工具配置（black、isort、mypy）统一在 `pyproject.toml` 中定义

### 4.3 依赖管理

- 使用 `uv` 作为包管理器
- 依赖版本在 `pyproject.toml` 的 `[project]` 部分定义
- 锁文件 `uv.lock` 必须提交到版本控制

## 5. 错误处理规范

### 5.1 错误类型

| 错误类型     | 处理方式                  | 示例                                            |
| ------------ | ------------------------- | ----------------------------------------------- |
| 输入验证错误 | 抛出 ValueError           | `raise ValueError("标题不能为空")`              |
| API 调用错误 | 重试机制（使用 tenacity） | `@retry(stop=stop_after_attempt(3))`            |
| 业务逻辑错误 | 返回错误状态              | `return {**state, "error_message": "处理失败"}` |

### 5.2 错误状态设计

```python
class ErrorState(TypedDict):
    """包含错误处理的状态"""
    data: str
    error_message: str | None
    error_code: str | None
    retry_count: int
```

### 5.3 日志记录

- 使用 Python 标准库 `logging`
- 日志级别：INFO（正常流程）、WARNING（可恢复错误）、ERROR（严重错误）
- 日志格式：包含时间戳、日志级别、模块名、消息

## 6. 文档规范

### 6.1 README 模板

每个示例的 README 必须包含以下部分：

```markdown
# Example XX: [示例名称]

## 复杂度

⭐ [1-5] 颗星

## 需求

### 背景

[业务背景说明]

### 功能需求

[详细功能描述]

### 技术要求

#### LangGraph 学习点

- [学习的核心概念 1]
- [学习的核心概念 2]

#### 实现要点

1. [技术实现要点 1]
2. [技术实现要点 2]

## 验收标准

1. [标准 1]
2. [标准 2]

## 示例输入输出
```

[示例代码和输出]

```

## 扩展思考
[可选的扩展方向]
```

### 6.2 代码注释

- 每个函数必须有文档字符串
- 复杂逻辑必须有行内注释
- 使用类型提示（Type Hints）

## 7. 安全规范

### 7.1 敏感信息

- API 密钥、密码等敏感信息不得硬编码在代码中
- 使用环境变量或密钥管理服务
- `.env` 文件必须添加到 `.gitignore`

### 7.2 输入验证

- 所有用户输入必须验证
- 使用白名单验证输入内容
- 防范注入攻击（Prompt 注入、代码注入）

### 7.3 访问控制

- 实现适当的权限检查
- 记录敏感操作日志
- 支持操作审计

## 8. 部署与运维规范

### 8.1 运行环境

```bash
# 标准运行命令
uv run python main.py

# 开发模式运行
uv run --dev python main.py
```

## 附录

### A. 检查清单

- [ ] 代码遵循 PEP 8 规范
- [ ] 所有函数有类型提示和文档字符串
- [ ] 环境变量配置正确
- [ ] 测试覆盖率达到要求
- [ ] README 文档完整
- [ ] 无敏感信息泄露风险
- [ ] 性能指标符合要求

### B. 参考资料

1. [LangGraph 官方文档](https://langchain-ai.github.io/langgraph/)
2. [Python 代码风格指南 (PEP 8)](https://peps.python.org/pep-0008/)
3. [语义化版本控制](https://semver.org/)
4. [Conventional Commits](https://www.conventionalcommits.org/)

---

**文档版本**：2.0  
**最后更新**：2025-12-07  
**适用范围**：所有 LangGraph 学习项目示例  
**状态**：✅ 公共技术约束已提炼完成
