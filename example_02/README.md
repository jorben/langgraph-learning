# Example 02: 条件分支 - 智能客服路由

## 复杂度
⭐⭐ 初级

## 需求

### 背景
实现一个智能客服系统，能够自动识别用户问题的类型，并将问题路由到相应的专业团队处理，模拟真实客服中心的工作流程。

### 功能需求

#### 1. 问题分类
系统需要识别以下三种问题类型：
- **技术问题**：产品使用、故障报修、功能咨询
- **销售问题**：价格咨询、产品对比、购买流程
- **投诉问题**：服务不满、退款申请、质量问题

#### 2. 核心流程

**步骤1：问题接收**
- 接收用户的问题描述
- 记录问题时间戳
- 生成问题ID

**步骤2：智能分类**
- 使用 LLM 分析问题内容
- 判断问题类型（技术/销售/投诉）
- 提取关键信息和紧急程度

**步骤3：路由处理**
- 根据分类结果路由到不同的处理节点
- 技术问题 → 技术支持团队
- 销售问题 → 销售顾问团队
- 投诉问题 → 客户关系团队

**步骤4：专业回复**
- 各团队根据专业知识生成回复
- 技术团队：提供解决方案和操作步骤
- 销售团队：提供产品信息和优惠方案
- 投诉团队：表达歉意并提供补偿方案

**步骤5：质量检查**
- 检查回复是否完整
- 评估回复质量
- 记录处理结果

#### 3. 状态管理
需要维护以下状态：
- `question_id`: 问题唯一标识
- `user_question`: 用户原始问题
- `question_type`: 问题类型（technical/sales/complaint）
- `urgency_level`: 紧急程度（low/medium/high）
- `handler`: 处理团队
- `response`: 生成的回复
- `quality_score`: 回复质量分数

### 技术要求

#### LangGraph 学习点
- 掌握 `add_conditional_edges()` 的使用
- 理解条件路由函数的编写
- 学习多分支节点的设计
- 掌握状态字段的动态更新
- 理解如何根据状态值做决策

#### 实现要点
1. 编写路由函数，返回下一个节点名称
2. 使用字典映射路由结果到节点
3. 不同处理节点有不同的处理逻辑
4. 所有分支最终汇聚到质量检查节点

### 验收标准

1. **分类准确性**
   - 能够正确识别三种问题类型
   - 边界情况也能合理分类

2. **路由正确性**
   - 不同类型问题路由到正确的处理节点
   - 路由逻辑清晰可追踪

3. **回复质量**
   - 技术/销售/投诉团队回复风格明显不同
   - 回复内容贴合问题类型
   - 语气专业且友好

4. **代码质量**
   - 条件分支逻辑清晰
   - 易于扩展新的问题类型
   - 注释详细

### 示例输入输出

**示例1：技术问题**
```
输入: "我的软件无法启动，点击图标没有反应"

输出:
问题ID: Q20231207001
类型: 技术问题
紧急程度: 高
处理团队: 技术支持团队
回复: 您好！关于软件无法启动的问题，请尝试以下步骤...
质量分数: 9.2/10
```

**示例2：销售问题**
```
输入: "专业版和企业版有什么区别？现在有优惠吗？"

输出:
问题ID: Q20231207002
类型: 销售问题
紧急程度: 中
处理团队: 销售顾问团队
回复: 感谢您的咨询！专业版和企业版的主要区别...
质量分数: 8.8/10
```

**示例3：投诉问题**
```
输入: "我昨天买的产品有质量问题，要求退款！"

输出:
问题ID: Q20231207003
类型: 投诉问题
紧急程度: 高
处理团队: 客户关系团队
回复: 非常抱歉给您带来不便！我们高度重视您的反馈...
质量分数: 9.5/10
```

### 扩展思考

完成基础需求后，可以考虑：
1. 添加混合类型问题的处理（既是技术又是投诉）
2. 实现优先级队列，紧急问题优先处理
3. 添加人工客服介入机制
4. 记录处理历史，支持问题追踪
5. 实现客户满意度评分
6. 支持多轮对话而非单次问答
